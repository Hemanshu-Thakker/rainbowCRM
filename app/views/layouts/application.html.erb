<!DOCTYPE html>
<html>
  <head>
    <title>RainbowCRM</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'ajax_calls', 'data-turbolinks-track': 'reload' %>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  </head>

  <body>
    <section class="main">
      <!-- Side navbar -->
      <div class="sidebar">
        <div class="brand">
          <%= image_tag "logo.png" %>
        </div>
        <ul>
          <li><a href="<%= root_path %>">
            <div>
              <span><%= image_tag "home.png" %></span>Home
            </div>
          </a></li>
          <li><a href="<%= new_leads_path %>">
            <span><%= image_tag "insights.png" %></span>Create Order
          </a></li>
          <li><a href="">
            <span><%= image_tag "overview.png" %></span>Search
          </a></li>
          <li><a href="/admin_dashboard">
            <span><%= image_tag "overview.png" %></span>Admin Dashboard
          </a></li>
        </ul>
      </div>
      
      <!-- Container -->
      <div class="main-inner">
        <!-- navbar -->
        <nav>
          <form class="form-style">
            <input class="form-control" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
          </form>
          <div class="profile-info">
            <span><%= image_tag "avatar.png" %></span>
          </div>
        </nav>

        <!-- Main content -->
        <div class="main-content">
          <%= yield %>
        </div>
      </div>
    </section>

    
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
      $('#customer_select_2').select2({
          width: "80%",
          placeholder: 'Search for customer',
          minimumInputLength: -1
      });
      $('#item_select_2').select2({
          width: "80%",
          placeholder: 'Search for Item',
          minimumInputLength: -1, 
      });
      $('#popup-customer-submit').on('click', function(){
    var form = $("#cusomer-form-id");
    var data = {"customer": {}}
    $.each(form.serializeArray(), function(i, field) {
        data["customer"][field.name] = field.value;
    });
    data["customer"]["remote"] = true;
    $('#customer-close').click();
    if (true) {
      $.ajax({
        url: "/customers",
        type: "POST",
        beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
        data: data,
        success: function(data){
            console.log(data);
            var option = {
              id: data.id,
              name: data.name + '-' + data.company_name,
            }
            var newOption = new Option(option.name, option.id, true, true);
            $('#customer_select_2').append(newOption).trigger('change');
        },
        error: function(){
          console.log("AJAX call unsuccesful");
        }
      });
    }
    else{
      alert("The form has errors, couldn't be submitted");
    }
});
    </script>
  </body>
</html>
